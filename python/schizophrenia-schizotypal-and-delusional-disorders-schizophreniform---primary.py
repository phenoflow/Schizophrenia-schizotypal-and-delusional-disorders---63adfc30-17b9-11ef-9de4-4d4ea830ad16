# Kuan V, Denaxas S, Gonzalez-Izquierdo A, Direk K, Bhatti O, Husain S, Sutaria S, Hingorani M, Nitsch D, Parisinos C, Lumbers T, Mathur R, Sofat R, Casas JP, Wong I, Hemingway H, Hingorani A, 2024.

import sys, csv, re

codes = [{"code":"Eu20111","system":"readv2"},{"code":"E101z00","system":"readv2"},{"code":"Eu20y12","system":"readv2"},{"code":"Eu21.13","system":"readv2"},{"code":"E107300","system":"readv2"},{"code":"E100400","system":"readv2"},{"code":"E102500","system":"readv2"},{"code":"E105.00","system":"readv2"},{"code":"E100.11","system":"readv2"},{"code":"E100z00","system":"readv2"},{"code":"E105z00","system":"readv2"},{"code":"E10y100","system":"readv2"},{"code":"E107z00","system":"readv2"},{"code":"E107500","system":"readv2"},{"code":"E100300","system":"readv2"},{"code":"Eu20214","system":"readv2"},{"code":"E100200","system":"readv2"},{"code":"E102100","system":"readv2"},{"code":"Eu20600","system":"readv2"},{"code":"E102.00","system":"readv2"},{"code":"Eu20100","system":"readv2"},{"code":"Eu21.11","system":"readv2"},{"code":"E100.00","system":"readv2"},{"code":"E102000","system":"readv2"},{"code":"E102400","system":"readv2"},{"code":"E107000","system":"readv2"},{"code":"E10y.00","system":"readv2"},{"code":"E107200","system":"readv2"},{"code":"E100000","system":"readv2"},{"code":"E10..00","system":"readv2"},{"code":"E105500","system":"readv2"},{"code":"Eu21.14","system":"readv2"},{"code":"Eu21.17","system":"readv2"},{"code":"E10yz00","system":"readv2"},{"code":"1464.00","system":"readv2"},{"code":"Eu21.16","system":"readv2"},{"code":"Eu20y00","system":"readv2"},{"code":"E107.00","system":"readv2"},{"code":"E101400","system":"readv2"},{"code":"E107400","system":"readv2"},{"code":"Eu20212","system":"readv2"},{"code":"Eu21.12","system":"readv2"},{"code":"E101.00","system":"readv2"},{"code":"E102z00","system":"readv2"},{"code":"E10z.00","system":"readv2"},{"code":"E105200","system":"readv2"},{"code":"Eu20.00","system":"readv2"},{"code":"E10y.11","system":"readv2"},{"code":"ZV11000","system":"readv2"},{"code":"Eu20213","system":"readv2"},{"code":"Eu20200","system":"readv2"},{"code":"E100500","system":"readv2"},{"code":"Eu2..00","system":"readv2"},{"code":"E101500","system":"readv2"},{"code":"E101000","system":"readv2"},{"code":"Eu21.15","system":"readv2"},{"code":"E107100","system":"readv2"},{"code":"Eu20z00","system":"readv2"},{"code":"E105000","system":"readv2"},{"code":"E100100","system":"readv2"},{"code":"40386.0","system":"readv2"},{"code":"102446.0","system":"readv2"},{"code":"11244.0","system":"readv2"},{"code":"55236.0","system":"readv2"},{"code":"64533.0","system":"readv2"},{"code":"31362.0","system":"readv2"},{"code":"63867.0","system":"readv2"},{"code":"4390.0","system":"readv2"},{"code":"35274.0","system":"readv2"},{"code":"57666.0","system":"readv2"},{"code":"34236.0","system":"readv2"},{"code":"49420.0","system":"readv2"},{"code":"61501.0","system":"readv2"},{"code":"102311.0","system":"readv2"},{"code":"16905.0","system":"readv2"},{"code":"4261.0","system":"readv2"},{"code":"92994.0","system":"readv2"},{"code":"99199.0","system":"readv2"},{"code":"60013.0","system":"readv2"},{"code":"56438.0","system":"readv2"},{"code":"66410.0","system":"readv2"},{"code":"71250.0","system":"readv2"},{"code":"11055.0","system":"readv2"},{"code":"2113.0","system":"readv2"},{"code":"41022.0","system":"readv2"},{"code":"58866.0","system":"readv2"},{"code":"28562.0","system":"readv2"},{"code":"64993.0","system":"readv2"},{"code":"91547.0","system":"readv2"},{"code":"43800.0","system":"readv2"},{"code":"20785.0","system":"readv2"},{"code":"12777.0","system":"readv2"},{"code":"33693.0","system":"readv2"},{"code":"31589.0","system":"readv2"},{"code":"4843.0","system":"readv2"},{"code":"15958.0","system":"readv2"},{"code":"35848.0","system":"readv2"},{"code":"34389.0","system":"readv2"},{"code":"67768.0","system":"readv2"},{"code":"14743.0","system":"readv2"},{"code":"1494.0","system":"readv2"},{"code":"49223.0","system":"readv2"},{"code":"14971.0","system":"readv2"},{"code":"22104.0","system":"readv2"},{"code":"104763.0","system":"readv2"},{"code":"66766.0","system":"readv2"},{"code":"51322.0","system":"readv2"},{"code":"55221.0","system":"readv2"},{"code":"40981.0","system":"readv2"},{"code":"12771.0","system":"readv2"},{"code":"97919.0","system":"readv2"},{"code":"99000.0","system":"readv2"},{"code":"22644.0","system":"readv2"},{"code":"34966.0","system":"readv2"},{"code":"16537.0","system":"readv2"},{"code":"53985.0","system":"readv2"},{"code":"25546.0","system":"readv2"},{"code":"48054.0","system":"readv2"},{"code":"9281.0","system":"readv2"},{"code":"62449.0","system":"readv2"},{"code":"15733.0","system":"readv2"},{"code":"2117.0","system":"readv2"},{"code":"64264.0","system":"readv2"},{"code":"58532.0","system":"readv2"},{"code":"109634.0","system":"readv2"},{"code":"96883.0","system":"readv2"},{"code":"66077.0","system":"readv2"},{"code":"30985.0","system":"readv2"},{"code":"3984.0","system":"readv2"},{"code":"9422.0","system":"readv2"},{"code":"33383.0","system":"readv2"},{"code":"31738.0","system":"readv2"},{"code":"50060.0","system":"readv2"},{"code":"65127.0","system":"readv2"},{"code":"16764.0","system":"readv2"},{"code":"49761.0","system":"readv2"},{"code":"53625.0","system":"readv2"},{"code":"32222.0","system":"readv2"},{"code":"54387.0","system":"readv2"},{"code":"694.0","system":"readv2"},{"code":"73295.0","system":"readv2"},{"code":"23616.0","system":"readv2"},{"code":"35877.0","system":"readv2"},{"code":"44498.0","system":"readv2"},{"code":"58716.0","system":"readv2"},{"code":"31493.0","system":"readv2"},{"code":"854.0","system":"readv2"},{"code":"58862.0","system":"readv2"},{"code":"8407.0","system":"readv2"},{"code":"63478.0","system":"readv2"},{"code":"10575.0","system":"readv2"},{"code":"43405.0","system":"readv2"},{"code":"30619.0","system":"readv2"},{"code":"33847.0","system":"readv2"},{"code":"39062.0","system":"readv2"},{"code":"11172.0","system":"readv2"},{"code":"53032.0","system":"readv2"},{"code":"6325.0","system":"readv2"},{"code":"39316.0","system":"readv2"},{"code":"99070.0","system":"readv2"},{"code":"102427.0","system":"readv2"},{"code":"17281.0","system":"readv2"},{"code":"88275.0","system":"readv2"},{"code":"36172.0","system":"readv2"},{"code":"37681.0","system":"readv2"},{"code":"107222.0","system":"readv2"},{"code":"66506.0","system":"readv2"},{"code":"38063.0","system":"readv2"},{"code":"47947.0","system":"readv2"},{"code":"51903.0","system":"readv2"},{"code":"18053.0","system":"readv2"},{"code":"37580.0","system":"readv2"},{"code":"104760.0","system":"readv2"},{"code":"61098.0","system":"readv2"},{"code":"58687.0","system":"readv2"},{"code":"91511.0","system":"readv2"},{"code":"31455.0","system":"readv2"},{"code":"33410.0","system":"readv2"},{"code":"101987.0","system":"readv2"},{"code":"62405.0","system":"readv2"},{"code":"3890.0","system":"readv2"},{"code":"94299.0","system":"readv2"},{"code":"94001.0","system":"readv2"},{"code":"24107.0","system":"readv2"},{"code":"33338.0","system":"readv2"},{"code":"20572.0","system":"readv2"},{"code":"85972.0","system":"readv2"},{"code":"50248.0","system":"readv2"},{"code":"22188.0","system":"readv2"},{"code":"101720.0","system":"readv2"},{"code":"98821.0","system":"readv2"},{"code":"49852.0","system":"readv2"},{"code":"F20","system":"readv2"}];
REQUIRED_CODES = 1;
with open(sys.argv[1], 'r') as file_in, open('schizophrenia-schizotypal-and-delusional-disorders-potential-cases.csv', 'w', newline='') as file_out:
    csv_reader = csv.DictReader(file_in)
    csv_writer = csv.DictWriter(file_out, csv_reader.fieldnames + ["schizophrenia-schizotypal-and-delusional-disorders-schizophreniform---primary-identified"])
    csv_writer.writeheader();
    codes_identified = 0;
    for row in csv_reader:
        newRow = row.copy();
        for cell in row:
            # Iterate cell lists (e.g. codes)
            for item in re.findall(r'\(([^,]*)\,', row[cell]):
                if(item in list(map(lambda code: code['code'], codes))): codes_identified+=1;
                if(codes_identified>=REQUIRED_CODES):
                    newRow["schizophrenia-schizotypal-and-delusional-disorders-schizophreniform---primary-identified"] = "CASE";
                    break;
            if(codes_identified>=REQUIRED_CODES): break;
        if(codes_identified<REQUIRED_CODES):
            newRow["schizophrenia-schizotypal-and-delusional-disorders-schizophreniform---primary-identified"] = "UNK";
        codes_identified=0;
        csv_writer.writerow(newRow)
